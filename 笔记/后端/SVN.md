# SVN概述

SVN是SubVersion的简称，是Apache研发的一个开源的版本控制系统

## SVN的作用

1. 实现项目组中的资源共享
2. 实现资源文件的版本控制

## SVN的工作原理

其他客户端都连接到SVN服务器，SVN服务器有一个中心版本库，记录每一次文件和目录的修改情况

## 传统文件共享方式的弊端

### 拷贝方式的弊端

1. 发送与接收文件的工作量巨大
2. 无法及时获取到更新
3. 对于之前版本的恢复较难，即使可以恢复，也大量浪费空间
4. 若一个文件由多个人修改，则会出现内容冲突，且难于确定修改的具体时间及修改人

### 文件服务器方式的弊端

1. 空间大量浪费
2. 资源无法设置访问权限
3. 资源安全性很低
4. 发生冲突资源，无法自动合并

## SVN体系结构

客户层，服务层，仓库层

# SVN命令行使用

## 安装

配置环境变量SVN_HOME，和Path下增加%SVN_HOME%\bin

让svn服务开机自启：sc create SVNServer binpath= "E:/svn/bin/svnserve.exe --service -r E:/svn/repository" start=auto depend=Tcpip

## SVN常用命令

### SVN管理员命令

svnadmin 开头

svnadmin help

svnadmin help create

svnadmin -version

synadmin create：该命令用于创建SVN版本仓库，确切地说是根仓库。SVN有两种仓库：顶层仓库和根仓库。在创建根仓库时，顶层仓库必须存在(即手动创建文件夹)

### SVN服务端命令

svnserve -d：用于开启DOS系统下的SVN服务，SVN服务默认的端口号为3690

svnserve -r 顶层仓库路径：将顶层仓库路径隐藏起来

### SVN客户端命令

#### svn checkout

命令格式：svn checkout 服务器指定根仓库 客户端连接仓库

checkout称为检出

意义是：创建服务器指定根仓库与本机指定目录的连接关系，客户端指定的目录称为working copy。

一个客户端一般情况下只需要检出一次。

---

基于顶层仓库下的检出

如果省略了客户端连接仓库，则会在执行命令的目录(working copy)下创建根仓库的文件夹，里面有.svn隐藏文件夹

如果不省略，则会在指定目录直接生成.svn隐藏文件夹

---

基于根仓库下的检出

与基于顶层仓库中的检出不同，无论省不省略，都会直接在working copy下生成.svn隐藏文件夹

#### svn add

命令格式：svn add 文件路径

当一个文件/目录，被存放到 Working Copy 中时，SVN并不会感知他们的存在，即SVN不会对其管理，若要使用SVN对其管理，必须将其通知add命令，添加到SVN管理中，需要注意，被add的文件/目录，必须存在于Working Copy中

需要注意：

1. 被add的文件/目录，必须存在于working copy中
2. add命令的作用就是将指定文件/目录交由SVN管理，与文件是否被更改过无关，因此一般情况，执行一次add就行
3. add目录时，会将目录及其所有的文件/目录，一次性交给SVN管理

#### svn commit

命令格式：commit 提交文件 -m 日志信息

commit命令用于将客户端working copy中所有对文件/目录的操作提交到服务器。

commit命令必须携带参数-m，用于完成日志记录

提交后的文件，在服务端时无法直接看到的，因为他并不是以整个文件的形式存在的

对于已提交的文件，未做更改再次提交是不能成功的

#### svn update

有了update，就可以只svn checkout一次了

#### svn delete

用于删除已提交了的客户端中的文件/目录，本地客户端会删除，但只有svn commit之后才能提交到服务端

#### svn revert

恢复刚刚svn delete/或在资源管理器中删除的文件，但commit后的不行，如果有多个还需在后面指定

如果要从其他客户端恢复已经被删除的文件，需要先将文件移出working copy，再svn update，然后把文件移回来，再svn add，最后svn commit

#### svn list

获取当前文件夹下的目录和文件

目录：abc/

文件：users.txt

#### svn info

获取到svn客户端和服务端的一些相关信息

#### svn help

用于获取svn命令的帮助信息，可以查看所有的svn命令

# TortoiseSVN

## 下载

Apache官网的subversion中下载，有两个msi，客户端安装程序和语言包安装程序

## 客户端不显示图标

因为Windows支持Overlay Icon(覆盖图标)最多15个，而Windows本身和其他应用程序已经用了这15个，所以SVN安装成功后，图标没有变化

## 导入导出

在要导入的文件夹上右击import，即可完成导入，需要注意导入是不会把右键的文件夹的本身导入

导出基本等于自己复制粘贴

## 冲突

当一个文件在两个客户端都被修改后，第一个客户端进行提交是没有问题的，但会将其修改过后的内容提交到服务端，但第二个客户端在进行提交后出问题，不能完成提交，这就是冲突

### 异行修改冲突

多个客户端对同一版本文件做出的修改，可以是任意的添加修改删除操作，只要他们修改的不是同一行数据内容，那么此时引发的冲突称为异行修改冲突

由于不同客户端的修改行是不相同的，所以SVN给出了比较简单的冲突解决方案，将修改进行合并，即大家的修改都起作用

### 同行修改冲突

只要多个客户端对同一版本文件的同一行数据进行了修改添加删除操作，此时引发的冲突称为同行修改冲突

由于不同客户端对于同一版本文件的修改内容是不用的，SVN无法自动给出冲突解决方案，此时只能人工完成取舍

### 混合修改冲突

与同行修改冲突一样，但异行修改冲突可以不用管

# 权限

## SVN服务器设置

1. 为认证用户设置权限
2. 注册密码配置文件
3. 注册权限配置文件
4. 指定要应用的根仓库

## 权限配置

authz文件

```
#分组
[groups]
leaders = aa

#只有rw 和 r，没有w
#根仓库所有目录的默认权限
[/]
aa = rw
bb = rw
cc = r

#单独设置某个目录的权限、
#注意，这里的权限只能比默认权限严格
[/com/hjdmmm/beans]
aa = rw
bb = r
#下一行是不正确的
cc = rw
[/com/hjdmmm/service]
#设置分组权限
@leaders = rw
```

## 密码配置

passwd文件

hjdmmm = 123

# IDEA中使用

## 配置

1. settings中配置svn.exe
2. 在VCS选项卡中建立连接，选中项目

## 常用功能

1. 添加
2. 检出
3. 更新
4. 提交
5. 删除
6. 删除后的恢复
7. 查看提交历史
8. 查看本地历史

# SVN与Apache服务器整合

使用SVN自身的服务协议svn://可以实现客户端与客服务端的通讯，但一般仅限于局域网内，若要从外网访问SVN服务器，一般是通过http协议完成的，且服务器所使用的服务器一般为Apache服务器

## Apache服务器

并不是所有Apache发行的服务器都叫Apache服务器，这里所说的Apache服务器指的是Apache Http Server

### 常用命令

1. httpd：不带任何参数的该命令，可以启动Apache服务，但该启动方式的弊端是，命令行一直处于等待状态，不能执行其他命令，也不能结束，一般不使用
2. httpd -k install：安装服务
3. httpd -k uninstall：卸载服务
4. httpd -k start：开启服务
5. httpd -k stop：停止服务

## 整合步骤

很繁琐

# 根仓库标准目录结构说明

## trunk

主开发目录

主要的开发在此进行

## branches

作为分支开发目录

对tags里的稳定版本的bug修复，与trunk同步开发

## tags

作为存档目录

一般情况下为只读

当一个版本号稳定后，写入这里

---

# git

分布式版本控制系统

# git基本操作

工作目录git add-->暂存区域git commit-->本地仓库git push-->远程仓库

从远程仓库第一次得到文件叫git clone

从远程仓库更新得到文件叫git pull

# 权限管理

